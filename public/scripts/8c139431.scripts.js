"use strict";angular.module("vendor",["ngCookies","ngAnimate","ngSanitize","ui.bootstrap","ui.router"]),angular.module("write",[]),angular.module("models",[]),angular.module("shared",[]),angular.module("wrdz",["vendor","write","models","shared"]).config(["$locationProvider",function(a){a.html5Mode(!0)}]).run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]),angular.module("shared").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("landing",{url:"/",templateUrl:"partials/landing.html",controller:["$scope","$state",function(a,b){a.user&&b.go("write"),a.$on("userChange",function(a,c){c&&b.go("write")})}]}).state("twitter",{url:"/auth/twitter",templateUrl:"partials/landing.html",controller:["$scope","$timeout",function(a,b){b(function(){location.reload(!0)},100)}]}).state("google",{url:"/auth/google",templateUrl:"partials/landing.html",controller:["$scope","$timeout",function(a,b){b(function(){location.reload(!0)},100)}]}).state("write",{url:"/w",templateUrl:"partials/write.html"})}]),angular.module("shared").controller("MainCtrl",["$scope","User","$modal","$window","$timeout",function(a,b,c,d){function e(){var a=b.getUser();a&&!a._userDocs&&b.getCurrentUser(a._id).success(function(a){b.changeUser(a.user)}).error(function(){})}e(),a.$on("userChange",function(b,c){a.user=c?c:null}),a.goToTop=function(){d.scrollTo(0,0)},a.bodyClick=function(){a.$broadcast("bodyClick")},a.aboutModal=function(){c.open({templateUrl:"partials/about-modal.html",controller:["$scope","$modalInstance","$http",function(a,b){a.close=function(){b.close()},a.feedbackModal=function(){a.close();c.open({templateUrl:"partials/feedback-modal.html",controller:["$scope","$modalInstance","$http",function(a,b,c){a.close=function(){b.close()},a.submitFeedback=function(b){console.log(b);var d={content:b};return a.close(),c.post("/feedback",d)}}]})}}]})}}]),angular.module("write").controller("WriteCtrl",["$scope","Write","$timeout","$window","$modal",function(){}]),angular.module("wrdz").directive("mediumEditor",["$timeout",function(a){return{require:"ngModel",restrict:"AE",link:function(b,c,d,e){angular.element(c).addClass("angular-medium-editor");var f={};d.options&&(f=angular.fromJson(d.options));var g=f.placeholder;c.on("blur keypress keydown keyup change",function(){b.$apply(function(){if("<p><br></p>"==c.html()||""==c.html()||"<br>"==c.html()){f.placeholder=g;{new MediumEditor(c,f)}}a(function(){e.$setViewValue(c.html())},100)})}),e.$render=function(){if(!a){e.$isEmpty(e.$viewValue)?d.$set("data-placeholder",angular.fromJson(d.options).placeholder):(f.placeholder="",d.$set("data-placeholder",""));var a=new MediumEditor(c,f)}c.html(e.$isEmpty(e.$viewValue)?"":e.$viewValue)}}}}]),angular.module("shared").directive("writeUnit",function(){return{restrict:"AE",controller:["$scope","$timeout","Write",function(){}],link:function(){}}}),angular.module("shared").directive("docDate",function(){return{restrict:"AE",scope:{date:"@date",datesShowing:"=datesShowing"},link:function(a,b){a.show=!1;var c=moment(a.date).format("MMMM DD, YYYY");-1===a.datesShowing.indexOf(c)&&(a.show=!0,a.datesShowing.push(c),b.text(c))}}}),angular.module("shared").filter("startFrom",function(){return function(a,b){return b=+b,a.slice(b)}}),angular.module("write").factory("Write",["User","Doc","$rootScope",function(a,b,c){function d(){var b=a.getUser();UserDoc.create().then(function(a){var d=a.data;d.body="<h4>Welcome to Wrdz</h4><p>This is your writing surface.</p><p>Write anything you want here!</p><p><span style='line-height: 1.3;'>Highlight this text to see your formatting options.</span></p><p><br></p>",docs.unshift(d),b._userDocs.unshift(d),c.$broadcast("focus-doc",d._id),console.log("creating new doc")})}var e=angular.toJson({placeholder:"",buttons:["bold","italic","unorderedlist","orderedlist"],buttonLabels:{header2:"<b>H</b>",anchor:"<span><span class='icon ion-link'></span></span>",bold:"<strong>b</strong>",italic:"<em><b>i</b></em>"},disableToolbar:!1,cleanPastedHTML:!0,checkLinkFormat:!0,targetBlank:!0,anchorPreviewHideDelay:500});return{createFirstDoc:d,getMediumOptions:e}}]),angular.module("models").factory("User",["$http","$cookieStore","$rootScope",function(a,b,c){function d(a){e=a,c.$broadcast("userChange",a)}var e=b.get("user")||null;return b.remove("user"),{changeUser:d,isLoggedIn:function(){return e?!0:!1},getUser:function(){return e?e:void 0},setUser:function(a){a&&(e=a)},update:function(b,c){var d={data:c};return a.post("/users/"+e._id+"/?type="+b,d)},getCurrentUser:function(b){return a.get("users/"+b)},resetPassword:function(b,c){var d={email:b,password:c};return a.post("/reset",d)},testUsername:function(b){var c={username:b};return a.post("/usernametest",c)},signup:function(b){return a.post("/signup",b)},signin:function(b){return a.post("/login",b)},logout:function(){return a.get("/logout")},twitter:function(){return a.get("/auth/twitter")},getOneUser:function(b){return a.get("/users/simple/"+b)}}}]),function(){function a(a,b){_.extend(this,{_http:a,_path:b})}a.$factory=["$http",function(b){return function(c){return new a(b,c)}}],angular.module("shared").factory("Resource",a.$factory),a.prototype.path=function(a){return a?this._path+"/"+a:this._path},a.prototype.set=function(a,b){var c=Q.defer(),d=this._path+"/"+a;return this._http.put(d,b).success(c.resolve).error(c.reject),c.promise},a.prototype.create=function(){var a=Q.defer(),b=this._path;return this._http.post(b).success(a.resolve).error(a.reject),a.promise},a.prototype.remove=function(a){var b=Q.defer(),c=this._path+"/"+a;return this._http.delete(c).success(b.resolve).error(b.reject),b.promise},a.prototype.find=function(a){var b,c=Q.defer();return b=a?this._path+"/"+a:this._path,this._http.get(b).success(c.resolve).error(c.reject),c.promise}}(),function(){function a(a){return a.inspect?void this.$unwrap(a):void _.extend(this,a)}a.$factory=["$timeout","Resource",function(b,c){return _.extend(a,{$$resource:new c("/docs"),$timeout:b}),a}],angular.module("models").factory("Doc",a.$factory),a.$find=function(b){var c=this.$$resource.find(b);return b?new a(c):a.$unwrapCollection(c)},a.$create=function(){var b=this.$$resource.create();return new a(b)},a.$remove=function(a){this.$$resource.remove(a)},a.$set=function(a,b){this.$$resource.set(a,b)},a.prototype.$unwrap=function(b){var c=this;this.$futureDocData=b,this.$futureDocData.then(function(b){a.$timeout(function(){_.extend(c,b)})})},a.$unwrapCollection=function(b){var c=[];return c.$futureDocData=b,b.then(function(b){a.$timeout(function(){_.reduce(b,function(b,c){return b.push(new a(c)),b},c)})}),c}}(),angular.module("write").controller("DocsCtrl",["$scope","$timeout","Doc","Write",function(a,b,c,d){a.moment=moment,a.datesShowing=[],a.docs=c.$find(),console.log(a.docs),a.newDoc=function(){var d=c.$create();d.updated_at=moment().format(),a.docs.push(d),b(function(){document.getElementById(d._id).focus()},200)},a.remove=function(b){c.$remove(b._id),a.docs.splice(a.docs.indexOf(b),1)},a.mediumEditorOptionsBody=d.getMediumOptions,a.bodyChange=function(a){c.$set(a._id,a)}}]);